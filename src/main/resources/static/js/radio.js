function init_player(json){if(-2==json.status&&document.location.reload(),$(".channel").removeClass("actived"),"undefined"==typeof json.channel){$(".channel-luoo").addClass("actived");var obj=$(".channel-luoo")}else{$(".channel[data-id="+json.channel+"]").addClass("actived");var obj=$(".channel[data-id="+json.channel+"]");$luooPlayer.data("channel",json.channel)}"undefined"!=typeof json.uid&&$luooPlayer.data("uid",json.uid),progress_color(json.channel),$("#channelName").text(obj.attr("title"));var pl=json.code;if(!pl)return!1;try{eval("var playlist = "+GibberishAES.dec(pl,$.luoo.cfg.aes))}catch(e){console.error("Error initating player")}if("undefined"==typeof playlist)return!1;var cssSelector={seekBar:".loaded",playBar:".escaped"},cssSelectorAncestor={jPlayer:"#luooPlayerContent",cssSelectorAncestor:"#luooPlayerPlaylist"},options={playlistOptions:{autoPlay:!0,loopOnPrevious:!0,repeatone:!1},swfPath:$.luoo.root+"/static/thirdparty/jplayer",supplied:"mp3",loop:!0,playbackRate:2,keyEnabled:!0,remainingDuration:!0,cssSelector:cssSelector};luooPlayer=new jPlayerPlaylist(cssSelectorAncestor,playlist,options),$("#luooPlayerPlaylist").unbind($.jPlayer.event.ready).bind($.jPlayer.event.ready,function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)});luooPlayer.playerid=b,$luooPlayer.data("page",1)}),$("#luooPlayerPlaylist").unbind($.jPlayer.event.play).bind($.jPlayer.event.play,function(evt){$("#cover").attr("src",luooPlayer.playlist[luooPlayer.current].poster),$("#trackname").html('<a href="'+url("single/"+luooPlayer.playlist[luooPlayer.current].id)+'" target="_blank">'+luooPlayer.playlist[luooPlayer.current].title+"</a>"),$("#performer").text(luooPlayer.playlist[luooPlayer.current].artist),$("#btnLike").data("id",luooPlayer.playlist[luooPlayer.current].id);var share_data={img:luooPlayer.playlist[luooPlayer.current].poster,id:luooPlayer.playlist[luooPlayer.current].id,text:"推荐"+luooPlayer.playlist[luooPlayer.current].artist+"的歌曲"+luooPlayer.playlist[luooPlayer.current].title+"（分享自@落网）",app:"single"};if($("#shareBtns").html(share_html(share_data)),$("title").text(luooPlayer.playlist[luooPlayer.current].title+"-落网"),luooPlayer.playlist[luooPlayer.current].is_fav?$("#btnLike").addClass("icon-radio-faved"):$("#btnLike").removeClass("icon-radio-faved"),parseInt($.luoo.res.uid)>0&&(clearTimeout(log_int),log_int=setTimeout(function(){$.luoo.get(url("data/play/"+luooPlayer.playlist[luooPlayer.current].id))},3e4)),"undefined"!=typeof window.WebSocket)try{var wsServer="ws://muma.luoo.net:8000/",websocket=new WebSocket(wsServer);websocket.onopen=function(){websocket.send(JSON.stringify({sessid:$.luoo.res.sessid,playerid:luooPlayer.playerid})),luooPlayer.readyStatus=1},websocket.onmessage=function(a){var a=JSON.parse(a.data);a.sessid==$.luoo.res.sessid&&luooPlayer.playerid!=a.playerid&&luooPlayer.pause()},websocket.onerror=function(a){},websocket.onclose=function(){}}catch(e){console.error("websocket error")}if(luooPlayer.current>=luooPlayer.playlist.length-1){if(void 0==$luooPlayer.data("channel"))var data={};else if(0==$luooPlayer.data("channel"))var data={uid:$luooPlayer.data("uid"),p:$luooPlayer.data("page")-0+1};else var data={channel:$luooPlayer.data("channel")};$.luoo.get(url("radio/code"),data,function(json){if(void 0!=json.p?$luooPlayer.data("page",json.p):$luooPlayer.data("page",$luooPlayer.data("page")-0+1),"string"==typeof json.code){try{eval("var media = "+GibberishAES.dec(json.code,$.luoo.cfg.aes)+";")}catch(e){}if("object"==typeof media&&media[0].id)for(i in media)luooPlayer.add(media[i])}$(".channel").data("status",0),"undefined"==typeof json.channel?$(".channel-luoo").data("status",1):$(".channel[data-id="+json.channel+"]").data("status",1)})}})}function radio_like_callback(a,b){b.data("disabled",!1);var c=$("#btnLike");if(-1===a.status){b.data({remote:url("login/dialog"),width:235});var d=b.tip();d.set("events.hide",function(a,b){b.destroy(),$.luoo.destroy_tip(b.id)}),$.luoo.tips.push(d)}else 1===a.status?(c.addClass("icon-radio-faved"),luooPlayer.playlist[luooPlayer.current].is_fav=1):2===a.status?(c.removeClass("icon-radio-faved"),luooPlayer.playlist[luooPlayer.current].is_fav=0):a.msg&&$.luoo.msg(a.msg)}function share_html(a){if(!a.app||!a.id||!a.text)return!1;if("vol"==a.app)var b=url("music/"+parseInt(a.id));else var b=url(a.app+"/"+parseInt(a.id));var c=a.img?a.img:"",d="http://service.weibo.com/share/share.php?url="+encodeURIComponent(b)+"&title="+encodeURIComponent(a.text)+"&source="+encodeURIComponent("落网")+"&sourceUrl="+encodeURIComponent("http://luoo.net")+"&content=utf-8&pic="+encodeURIComponent(c),e="http://www.douban.com/share/service?bm=1&image="+encodeURIComponent(c)+"&href="+encodeURIComponent(b)+"&updated=&name="+encodeURIComponent(a.text),f="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(b)+"&desc="+encodeURIComponent(a.text)+"&pics="+encodeURIComponent(c),g='<a href="javascript:;" class="btn-action-linkout" data-href="'+d+'" target="_blank"><span class="icon icon-radio-weibo"></span></a><a href="javascript:;" class="btn-action-linkout" data-href="'+e+'" target="_blank"><span class="icon icon-radio-douban"></span></a><a href="javascript:;" class="btn-action-linkout" data-href="'+f+'" target="_blank"><span class="icon icon-radio-qzone"></span></a>';return g}function progress_color(a){if("undefined"!=typeof a)var b={0:"#E43E4A",1:"#60adfb",2:"#a4a4a4",3:"#3e3e3e",4:"#b61521"},c=b[a];else var c="#51ac9a";$("#progressEscaped").css("background",c)}function picwall(){if("undefined"==typeof covers)return!1;var a=$("#picwall"),b=150,c=$(window).width(),d=$(window).height(),e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC";a.width(Math.ceil(c/b)*b).height(Math.ceil(d/b)*b);for(var f=Math.ceil(c/b)*Math.ceil(d/b),g="",h=0;f>h;h++)g+=h%2==0?'<img class="pic" src="'+e+'" data-original="'+covers[h]+'">':'<img class="pic" src="'+e+'" data-original="'+covers[h]+'">';a.html(g),$(".pic").width(b).height(b),$(".pic").lazyload({effect:"fadeIn"})}var luooPlayer,log_int,channelToggleInt,$luooPlayer;$(document).ready(function(){$luooPlayer=$("#luooPlayerContent");var data={};radio_user&&(data.uid=radio_user),$.luoo.get(url("radio/code"),data,function(a){init_player(a)}),$("#channelSelector").click(function(){$("#channelsWrapper").toggle()}),$(".channel").click(function(e){e.stopPropagation();var id=$(this).data("id");if($luooPlayer.data("channel",id),0==id)var data={uid:0};else var data={channel:id};$.luoo.get(url("radio/code"),data,function(json,obj){if(-2==json.status&&document.location.reload(),-1==json.status)var tip=obj.tip();else if(json.code){try{eval("var media = "+GibberishAES.dec(json.code,$.luoo.cfg.aes)+";")}catch(e){}luooPlayer.setPlaylist(media)}if($(".channel").removeClass("actived"),"undefined"==typeof json.channel){$(".channel-luoo").addClass("actived");var obj=$(".channel-luoo")}else{$(".channel[data-id="+json.channel+"]").addClass("actived");var obj=$(".channel[data-id="+json.channel+"]");$luooPlayer.data("channel",json.channel)}"undefined"!=typeof json.uid&&$luooPlayer.data("uid",json.uid),progress_color(json.channel),$("#channelName").text(obj.attr("title"))},$(this))}),$(window).height()>580&&($("#radioBg").height($(window).height()-50).show(),$("#radioBgMask").height($(window).height()).show(),$("#luooPlayerPlaylist").css({marginTop:($(window).height()-302)/2-90}).show()),$(window).resize(function(){$(window).height()>580&&($("#radioBg").height($(window).height()-50),$("#radioBgMask").height($(window).height()),$("#luooPlayerPlaylist").css({marginTop:($(window).height()-302)/2-90}),picwall())}),$("#coverWrapper").mouseenter(function(){$(".share-bg").stop().animate({bottom:0},200),$(".share-wrapper").stop().animate({bottom:0},200)}),$("#coverWrapper").mouseleave(function(){$(".share-bg").animate({bottom:-43},200),$(".share-wrapper").animate({bottom:-43},200)}),$("body").on("keyup",function(a){70==a.keyCode&&$.luoo.res.uid&&$("#btnLike").click()}),picwall()});